# 🖥️ RefClient - GUI 테스트 클라이언트 (v0.1.12)

## 📄 프로젝트 개요
RefClient는 RefServer의 모든 테스트 기능을 GUI로 제공하는 PyQt6 기반 클라이언트 애플리케이션입니다. 기존 tests/ 디렉토리의 CLI 테스트 스크립트들을 사용자 친화적인 GUI 환경으로 통합합니다.

## 🎯 핵심 기능 (v0.1.12)
- **3탭 우선순위 기반 인터페이스**: 사용자 우선도에 따른 직관적 탭 구조
  1. **📁 파일 업로드**: PDF 업로드 및 처리 테스트 (최우선)
  2. **🔍 서버 상태**: 서버 및 서비스 상태 점검 (2순위)
  3. **⚙️ 관리 기능**: 관리자 기능 및 시스템 관리 (3순위)
- **실시간 상태 모니터링**: 서버 연결, 배포 모드, 처리 진행률 실시간 표시
- **공유 로그 뷰어**: 모든 탭의 작업 로그를 하단에 통합 표시
- **설정 관리**: 서버 URL, 인증 정보, 테스트 옵션 관리

## 📁 디렉토리 구조
```
RefClient/
├── gui/                    # GUI 애플리케이션
│   ├── main.py            # PyQt6 메인 애플리케이션 (v0.1.12 탭 기반)
│   ├── widgets/           # 커스텀 위젯
│   │   ├── file_upload_tab.py     # 파일 업로드 탭 (1순위)
│   │   ├── server_status_tab.py   # 서버 상태 탭 (2순위)
│   │   ├── admin_functions_tab.py # 관리 기능 탭 (3순위)
│   │   ├── log_viewer.py          # 공유 로그 뷰어 위젯
│   │   └── settings.py            # 설정 위젯
│   ├── models/            # 데이터 모델
│   │   ├── test_model.py      # 테스트 데이터 모델
│   │   └── config_model.py    # 설정 데이터 모델
│   ├── utils/             # 유틸리티
│   │   ├── test_wrapper.py    # 기존 테스트 스크립트 래퍼
│   │   └── config_manager.py  # 설정 관리
│   └── resources/         # 리소스 파일
│       ├── icons/             # 아이콘
│       └── styles/            # CSS 스타일
├── tests/                 # 기존 테스트 스크립트들 (변경 없음)
│   ├── test_api.py
│   ├── test_api_core.py
│   ├── test_admin_system.py
│   ├── test_backup_system.py
│   └── test_ocr_language_detection.py
└── requirements.txt       # GUI 의존성 추가
```

## 🧩 기존 테스트 스크립트 분석

### 1. test_ocr_language_detection.py (가장 단순)
- **기능**: OCR 언어 감지 하이브리드 시스템 테스트
- **테스트 케이스**: 5개 언어 (영어, 한국어, 일본어, 중국어, 프랑스어)
- **메서드**: 텍스트 기반, OCR 기반, LLaVA 기반, 하이브리드 감지
- **GUI 요소**: 언어별 테스트 버튼, 결과 테이블, 정확도 차트

### 2. test_api_core.py (핵심 API)
- **기능**: RefServer 핵심 API 테스트
- **테스트 항목**: PDF 업로드, 처리 상태 폴링, 메타데이터 추출, 임베딩, 레이아웃 분석
- **GUI 요소**: 파일 선택, 진행률 바, 테스트 결과 트리뷰

### 3. test_api.py (전체 API)
- **기능**: RefServer 모든 API 엔드포인트 테스트
- **테스트 항목**: 25개+ 엔드포인트, 비동기/동기 처리, 에러 핸들링
- **GUI 요소**: 테스트 선택 체크박스, 전체 실행 버튼, 상세 로그

### 4. test_admin_system.py (관리자 기능)
- **기능**: 관리자 인터페이스 및 권한 관리 테스트
- **테스트 항목**: 로그인, 대시보드, 백업 관리, 일관성 검증
- **GUI 요소**: 인증 정보 입력, 관리자 기능 테스트 패널

### 5. test_backup_system.py (백업 시스템)
- **기능**: v0.1.12 백업, 복구, 일관성 시스템 테스트
- **테스트 항목**: SQLite 백업, ChromaDB 백업, 통합 백업, 재해 복구
- **GUI 요소**: 백업 유형 선택, 복구 시뮬레이션, 상태 모니터링

## 🎨 GUI 설계 계획

### v0.1.12 탭 기반 레이아웃
```
┌─────────────────────────────────────────────────────┐
│ RefClient - RefServer GUI 테스트 클라이언트 v0.1.12  │
├─────────────────────────────────────────────────────┤
│ 서버 상태: ✅ 연결됨 | 모드: GPU            [⚙️ 설정] │
├─────────────────────────────────────────────────────┤
│ ┌─ 주요 기능 탭 ───────────────────────────────────┐ │
│ │ [📁 파일 업로드] [🔍 서버 상태] [⚙️ 관리 기능]    │ │
│ │ ┌───────────────────────────────────────────────┐ │ │
│ │ │                                               │ │ │
│ │ │         현재 선택된 탭의 내용                   │ │ │
│ │ │   - 파일 업로드: PDF 선택, 업로드 진행률       │ │ │
│ │ │   - 서버 상태: 서비스 점검, 성능 모니터링      │ │ │
│ │ │   - 관리 기능: 인증, 백업, 서비스 관리         │ │ │
│ │ │                                               │ │ │
│ │ └───────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────┤
│ ┌─ 📋 실시간 로그 (모든 탭 공유) ─────────────────┐ │
│ │ [12:34:56] INFO: 파일 업로드 시작...            │ │
│ │ [12:34:57] PASS: 서버 상태 확인 - 정상 (200)    │ │
│ │ [12:34:58] INFO: 관리자 로그인 성공             │ │
│ └─────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

### v0.1.12 주요 위젯 구성
1. **FileUploadTab**: PDF 파일 업로드 및 처리 테스트 (최우선 기능)
   - 단일/다중 파일 선택, 업로드 진행률, 처리 결과 테이블
2. **ServerStatusTab**: 서버 및 서비스 상태 점검 (2순위 기능)
   - 빠른 상태 확인, 상세 테스트, Circuit Breaker 모니터링
3. **AdminFunctionsTab**: 관리자 기능 및 시스템 관리 (3순위 기능)
   - 인증 관리, 기능 테스트, 서비스 제어
4. **LogViewerWidget**: 실시간 로그 뷰어 (모든 탭 공유)
   - 레벨별 필터링, 색상 구분, 로그 저장
5. **SettingsWidget**: 서버 설정 다이얼로그
   - 서버 URL, 인증 정보, 연결 타임아웃 설정

## 🔧 기술 스택
- **GUI 프레임워크**: PyQt6
- **백그라운드 처리**: QThread, QWorker
- **데이터 모델**: QAbstractTableModel, QStandardItemModel
- **설정 관리**: QSettings (INI 파일)
- **로깅**: Python logging + QTextEdit
- **차트/그래프**: matplotlib + Qt backends

## 📋 구현 상태

### ✅ 완료된 기능 (v0.1.12)
- [x] **3탭 우선순위 기반 UI**: 사용자 중심 인터페이스 재설계
  - [x] **📁 파일 업로드 탭**: PDF 업로드 및 처리 (최우선 기능)
  - [x] **🔍 서버 상태 탭**: 서버/서비스 상태 점검 (2순위)
  - [x] **⚙️ 관리 기능 탭**: 관리자 기능 및 시스템 관리 (3순위)
- [x] **공유 로그 시스템**: 모든 탭의 활동을 하단 로그 뷰어에 통합
- [x] **실시간 서버 모니터링**: 상단 툴바에 연결상태/배포모드 실시간 표시
- [x] **워커 스레드 기반**: 각 탭별 독립적인 QThread 백그라운드 처리
- [x] **안전한 앱 종료**: 실행 중인 작업 확인 및 안전한 종료 처리
- [x] **설정 관리**: QSettings 기반 자동 저장/복원 시스템
- [x] **배포 모드 감지**: GPU/CPU 환경 자동 인식 및 UI 적응
- [x] **크로스 플랫폼**: Windows 인코딩 문제 해결 및 안정성 확보

### 🔧 핵심 컴포넌트

#### v0.1.12 GUI 컴포넌트
- **RefClientMainWindow**: 3탭 기반 메인 윈도우 (상단 상태바 + 하단 로그)
- **FileUploadTab**: PDF 업로드 및 처리 전담 탭 (FileUploadWorker 포함)
- **ServerStatusTab**: 서버 상태 점검 전담 탭 (ServerStatusWorker 포함)
- **AdminFunctionsTab**: 관리자 기능 전담 탭 (AdminTestWorker 포함)
- **LogViewerWidget**: 공유 로그 뷰어 (모든 탭에서 사용)
- **SettingsWidget**: 서버 설정 다이얼로그
- **ConfigManager**: QSettings 기반 설정 관리

#### 테스트 모듈 (gui/test_modules/)
- **BaseTest**: 공통 기능 (배포 모드 감지, API 호출, 로깅)
- **HealthTest**: 서버 연결성 및 헬스체크 (기존 OCR 언어감지 대체)
- **CoreApiTest**: 핵심 API 기능 (배포 모드별 적응형 테스트)
- **FullApiTest**: 전체 API 엔드포인트 상태 확인
- **AdminTest**: 관리자 시스템 및 인증 테스트
- **BackupTest**: 백업, 일관성, 재해복구 테스트

### 🚀 향후 개선 계획
- [ ] 테스트 결과 내보내기 (CSV, JSON, HTML 리포트)
- [ ] 테마 및 다크모드 지원
- [ ] 테스트 스케줄링 및 자동화 기능
- [ ] 성능 프로파일링 차트 및 벤치마크
- [ ] 자동 업데이트 확인 및 배포
- [ ] 테스트 커버리지 분석
- [ ] 네트워크 지연 시뮬레이션

## 📊 기대 효과
1. **사용성 향상**: CLI 명령어 없이 직관적인 GUI로 테스트 실행
2. **시각적 피드백**: 실시간 진행률, 결과 차트, 성능 지표
3. **효율성 증대**: 배치 테스트, 자동화된 리포팅
4. **접근성 개선**: 비개발자도 쉽게 RefServer 테스트 가능
5. **디버깅 지원**: 상세 로그, 단계별 실행, 에러 추적

## 📝 주요 테스트 스크립트 특징

### RefServerAPITester (test_api.py)
- **25개+ API 엔드포인트** 종합 테스트
- **비동기 처리 API** 지원 (upload → job status polling)
- **환경 적응형 테스트** (GPU/CPU 모드 자동 감지)
- **상세한 로깅** 및 성공률 계산
- **에러 핸들링** 및 timeout 처리

### RefServerCoreAPITester (test_api_core.py)
- **핵심 PDF 처리** 파이프라인 테스트
- **실시간 진행률 추적** 및 상태 모니터링
- **벡터 검색 API** 테스트 (v0.1.10+)
- **배포 모드별 기능** 차별화 테스트

### RefServerAdminTester (test_admin_system.py)
- **JWT 기반 로그인** 및 권한 관리
- **백업 시스템** 관리 인터페이스 테스트
- **일관성 검증** 시스템 테스트
- **Superuser 전용 기능** 분리 테스트

### RefServerBackupTester (test_backup_system.py)
- **SQLite/ChromaDB 백업** 생성 및 검증
- **통합 백업** 시스템 테스트
- **재해 복구 준비도** 평가
- **백업 무결성 검증** 및 복구 시뮬레이션

### OCR Language Detection (test_ocr_language_detection.py)
- **5개 언어** 감지 정확도 테스트
- **하이브리드 감지 시스템** (텍스트 → LLaVA → Multi-OCR)
- **테스트 PDF 동적 생성** 및 정리
- **엣지 케이스** 처리 테스트

## 🛠️ 기술 구현 상세

### 내부 테스트 모듈 시스템 (NEW!)
subprocess 대신 직접 Python 모듈 호출로 성능 및 안정성 향상:
- **BaseTest 클래스**: 모든 테스트의 공통 기능 (API 호출, 로깅, 배포 모드 감지)
- **QObject 신호/슬롯**: 실시간 로그 및 진행률 업데이트
- **배포 모드 감지**: `/status` API를 통한 GPU/CPU 환경 자동 인식
- **적응형 테스트**: 환경에 따른 테스트 항목 동적 조정
- **예외 처리**: Python Exception 기반 안정적인 오류 관리

### 설정 관리
- **QSettings 기반**: 설정 자동 저장/복원 (크로스 플랫폼)
- **서버 연결 정보**: URL, 포트, 타임아웃
- **인증 정보**: 관리자 사용자명, 패스워드 저장
- **테스트 옵션**: 선택적 테스트 실행, 로그 레벨
- **배포 모드 캐싱**: 감지된 GPU/CPU 모드 임시 저장

### 로그 시스템
- **실시간 로그 스트리밍**: 테스트 실행 중 즉시 표시
- **로그 레벨 필터링**: DEBUG, INFO, WARNING, ERROR
- **로그 내보내기**: 텍스트 파일로 저장
- **색상 코딩**: 로그 레벨별 시각적 구분

**현재 상태: GUI 클라이언트 v0.1.12 완전 구현 완료** 

✅ **v0.1.12 주요 성과**:
- **사용자 중심 인터페이스**: 우선순위 기반 3탭 구조로 완전 재설계
- **직관적인 탭 분리**: 파일 업로드(1순위) → 서버 상태(2순위) → 관리 기능(3순위)
- **통합 로그 시스템**: 모든 탭의 활동을 하단에서 실시간 모니터링
- **독립적 워커 스레드**: 각 탭별 전용 QThread 백그라운드 처리
- **실시간 상태 표시**: 상단 툴바에서 서버 연결/배포 모드 실시간 감지
- **안전한 멀티태스킹**: 실행 중인 작업 확인 및 안전한 종료 처리