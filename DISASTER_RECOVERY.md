# ğŸš¨ RefServer ì¬í•´ ë³µêµ¬ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ì¬í•´ ì‹œë‚˜ë¦¬ì˜¤](#ì¬í•´-ì‹œë‚˜ë¦¬ì˜¤)
2. [ë°±ì—… ì „ëµ](#ë°±ì—…-ì „ëµ)
3. [ë³µêµ¬ ì ˆì°¨](#ë³µêµ¬-ì ˆì°¨)
4. [ìë™ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸](#ìë™-ë³µêµ¬-ìŠ¤í¬ë¦½íŠ¸)
5. [ì˜ˆë°© ì¡°ì¹˜](#ì˜ˆë°©-ì¡°ì¹˜)
6. [ì²´í¬ë¦¬ìŠ¤íŠ¸](#ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## ğŸ¯ ì¬í•´ ì‹œë‚˜ë¦¬ì˜¤

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì†ìƒ
- **SQLite ë°ì´í„°ë² ì´ìŠ¤ ì†ìƒ**: íŒŒì¼ ì‹œìŠ¤í…œ ì˜¤ë¥˜, ë””ìŠ¤í¬ ì¥ì• 
- **ChromaDB ì¸ë±ìŠ¤ ì†ìƒ**: ë²¡í„° ë°ì´í„° ë¶ˆì¼ì¹˜, ì¸ë±ìŠ¤ ê¹¨ì§
- **ì¦ìƒ**: API ì˜¤ë¥˜, ê²€ìƒ‰ ì‹¤íŒ¨, ë°ì´í„° ì¡°íšŒ ë¶ˆê°€

### 2. ì„œë¹„ìŠ¤ ì¥ì• 
- **Docker ì»¨í…Œì´ë„ˆ í¬ë˜ì‹œ**: ë©”ëª¨ë¦¬ ë¶€ì¡±, í”„ë¡œì„¸ìŠ¤ ì˜¤ë¥˜
- **ì˜ì¡´ ì„œë¹„ìŠ¤ ì¥ì• **: Ollama, Huridocs ì—°ê²° ì‹¤íŒ¨
- **ì¦ìƒ**: 503 Service Unavailable, ì²˜ë¦¬ ì¤‘ë‹¨

### 3. ìŠ¤í† ë¦¬ì§€ ì¥ì• 
- **ë””ìŠ¤í¬ ê°€ë“ ì°¸**: ë°±ì—… íŒŒì¼ ëˆ„ì , ë¡œê·¸ ê³¼ë‹¤
- **íŒŒì¼ ì‹œìŠ¤í…œ ì˜¤ë¥˜**: ê¶Œí•œ ë¬¸ì œ, ë§ˆìš´íŠ¸ í•´ì œ
- **ì¦ìƒ**: ì—…ë¡œë“œ ì‹¤íŒ¨, ë°±ì—… ì‹¤íŒ¨

### 4. ì™„ì „ ì‹œìŠ¤í…œ ì¥ì• 
- **ì„œë²„ ë‹¤ìš´**: í•˜ë“œì›¨ì–´ ì¥ì• , ì „ì› ë¬¸ì œ
- **ë°ì´í„° ì„¼í„° ì¥ì• **: ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ, ì¬í•´
- **ì¦ìƒ**: ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨

---

## ğŸ’¾ ë°±ì—… ì „ëµ

### í˜„ì¬ ë°±ì—… êµ¬ì„±
```
ì¼ë³„ ë°±ì—…: ë§¤ì¼ ì˜¤ì „ 3ì‹œ (7ì¼ ë³´ê´€)
ì£¼ë³„ ë°±ì—…: ì¼ìš”ì¼ ì˜¤ì „ 4ì‹œ (30ì¼ ë³´ê´€)
ì‹œê°„ë³„ ì¦ë¶„: ë§¤ì‹œê°„ (2ì¼ ë³´ê´€)
```

### ë°±ì—… ìœ„ì¹˜
```
/data/backups/
â”œâ”€â”€ sqlite/
â”‚   â”œâ”€â”€ daily/
â”‚   â”œâ”€â”€ weekly/
â”‚   â””â”€â”€ incremental/
â”œâ”€â”€ chromadb/
â”‚   â”œâ”€â”€ daily/
â”‚   â”œâ”€â”€ weekly/
â”‚   â””â”€â”€ snapshots/
â””â”€â”€ metadata/
    â””â”€â”€ backup_history.json
```

### ì˜¤í”„ì‚¬ì´íŠ¸ ë°±ì—… (ê¶Œì¥)
```bash
# ì›ê²© ì„œë²„ë¡œ ë°±ì—… ë™ê¸°í™”
rsync -avz /data/backups/ user@backup-server:/backups/refserver/

# S3ë¡œ ë°±ì—… ì—…ë¡œë“œ
aws s3 sync /data/backups/ s3://my-bucket/refserver-backups/
```

---

## ğŸ”§ ë³µêµ¬ ì ˆì°¨

### 1. SQLite ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬

#### ìë™ ë³µêµ¬ (API ì‚¬ìš©)
```bash
# ìµœì‹  ë°±ì—… í™•ì¸
curl -X GET http://localhost:8060/admin/backup/history \
  -H "Authorization: Bearer YOUR_TOKEN"

# íŠ¹ì • ë°±ì—…ìœ¼ë¡œ ë³µêµ¬
curl -X POST http://localhost:8060/admin/backup/restore/BACKUP_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### ìˆ˜ë™ ë³µêµ¬
```bash
# 1. ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose down

# 2. í˜„ì¬ DB ë°±ì—… (ì•ˆì „ì„ ìœ„í•´)
cp /data/refserver.db /data/refserver.db.corrupted

# 3. ë°±ì—… íŒŒì¼ ì°¾ê¸°
ls -la /data/backups/sqlite/daily/

# 4. ë°±ì—… ë³µêµ¬
gunzip -c /data/backups/sqlite/daily/refserver_2025-01-20_daily.db.gz > /data/refserver.db

# 5. ê¶Œí•œ ì„¤ì •
chmod 644 /data/refserver.db

# 6. ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d
```

### 2. ChromaDB ë³µêµ¬

#### ìˆ˜ë™ ë³µêµ¬
```bash
# 1. ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose down

# 2. í˜„ì¬ ChromaDB ë°±ì—…
mv /data/chromadb /data/chromadb.corrupted

# 3. ë°±ì—… ë³µêµ¬
tar -xzf /data/backups/chromadb/daily/chromadb_20250120_120000_full.tar.gz -C /data/

# 4. ê¶Œí•œ ì„¤ì •
chown -R 1000:1000 /data/chromadb

# 5. ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d
```

### 3. í†µí•© ë³µêµ¬ (SQLite + ChromaDB)

ìµœì‹  í†µí•© ë°±ì—…ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë™ì‹œì— ë³µêµ¬:

```bash
# ìë™ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©
./scripts/disaster_recovery.sh --unified --backup-id "unified_20250120_030000"
```

### 4. ë¶€ë¶„ ë³µêµ¬

#### PDF íŒŒì¼ë§Œ ë³µêµ¬
```bash
# PDF íŒŒì¼ì€ ë³„ë„ ë°±ì—… í•„ìš”
rsync -av /backup/pdfs/ /data/pdfs/
```

#### íŠ¹ì • ì‹œì ìœ¼ë¡œ ë³µêµ¬ (Point-in-Time Recovery)
```bash
# íŠ¹ì • ë‚ ì§œì˜ ë°±ì—… ì°¾ê¸°
./scripts/disaster_recovery.sh --list --date "2025-01-19"

# í•´ë‹¹ ì‹œì ìœ¼ë¡œ ë³µêµ¬
./scripts/disaster_recovery.sh --restore --point-in-time "2025-01-19 14:00:00"
```

---

## ğŸ¤– ìë™ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸

### ê¸°ë³¸ ì‚¬ìš©ë²•
```bash
# ë„ì›€ë§
./scripts/disaster_recovery.sh --help

# ìƒíƒœ í™•ì¸
./scripts/disaster_recovery.sh --check

# ìµœì‹  ë°±ì—…ìœ¼ë¡œ ë³µêµ¬
./scripts/disaster_recovery.sh --restore-latest

# íŠ¹ì • ë°±ì—…ìœ¼ë¡œ ë³µêµ¬
./scripts/disaster_recovery.sh --restore --backup-id "BACKUP_ID"

# ê±´ê°• ìƒíƒœ í™•ì¸ í›„ ìë™ ë³µêµ¬
./scripts/disaster_recovery.sh --auto-recover
```

### ìŠ¤í¬ë¦½íŠ¸ ê¸°ëŠ¥
- ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ë¬´ê²°ì„± ê²€ì‚¬
- ìë™ ë°±ì—… ì„ íƒ
- ë³µêµ¬ ì „ ì•ˆì „ ë°±ì—…
- ë³µêµ¬ í›„ ê²€ì¦

---

## ğŸ›¡ï¸ ì˜ˆë°© ì¡°ì¹˜

### 1. ëª¨ë‹ˆí„°ë§
```bash
# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
df -h /data

# ë°ì´í„°ë² ì´ìŠ¤ ë¬´ê²°ì„± ì •ê¸° ê²€ì‚¬
sqlite3 /data/refserver.db "PRAGMA integrity_check;"

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
curl http://localhost:8060/health
```

### 2. ì •ê¸° ì ê²€
- **ì¼ì¼**: ë°±ì—… ìƒíƒœ í™•ì¸
- **ì£¼ê°„**: ë°±ì—… ë³µêµ¬ í…ŒìŠ¤íŠ¸
- **ì›”ê°„**: ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬ í›ˆë ¨

### 3. ì•Œë¦¼ ì„¤ì •
```bash
# ë°±ì—… ì‹¤íŒ¨ ì‹œ ì•Œë¦¼
# /etc/cron.d/refserver-monitoring
0 * * * * /scripts/check_backups.sh || mail -s "RefServer Backup Failed" admin@example.com
```

---

## âœ… ë³µêµ¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‚¬ì „ ì¤€ë¹„
- [ ] ìµœì‹  ë°±ì—… ìœ„ì¹˜ í™•ì¸
- [ ] ë°±ì—… ë¬´ê²°ì„± ê²€ì¦
- [ ] ë³µêµ¬ ê³„íš ìˆ˜ë¦½
- [ ] ê´€ë ¨ì í†µë³´

### ë³µêµ¬ ì‘ì—…
- [ ] ì„œë¹„ìŠ¤ ì¤‘ì§€
- [ ] í˜„ì¬ ìƒíƒœ ë°±ì—…
- [ ] ë°±ì—… íŒŒì¼ ë³µêµ¬
- [ ] ê¶Œí•œ ë° ì†Œìœ ê¶Œ ì„¤ì •
- [ ] ì„œë¹„ìŠ¤ ì¬ì‹œì‘

### ë³µêµ¬ í›„ ê²€ì¦
- [ ] API í—¬ìŠ¤ì²´í¬ (/health)
- [ ] ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
- [ ] ì£¼ìš” ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### ì‚¬í›„ ì¡°ì¹˜
- [ ] ë³µêµ¬ ë¡œê·¸ ì‘ì„±
- [ ] ì›ì¸ ë¶„ì„
- [ ] ì¬ë°œ ë°©ì§€ ëŒ€ì±…
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

## ğŸ“ ê¸´ê¸‰ ì—°ë½ì²˜

- **ì‹œìŠ¤í…œ ê´€ë¦¬ì**: admin@example.com
- **ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ì**: dba@example.com
- **24/7 ì§€ì›**: +1-XXX-XXX-XXXX

---

## ğŸ”„ ë³µêµ¬ ì‹œê°„ ëª©í‘œ (RTO/RPO)

- **RTO (Recovery Time Objective)**: 2ì‹œê°„ ì´ë‚´
- **RPO (Recovery Point Objective)**: 1ì‹œê°„ ì´ë‚´
- **ë°±ì—… ë³´ê´€ ê¸°ê°„**: ìµœì†Œ 30ì¼

---

## ğŸ“ ë³€ê²½ ì´ë ¥

- v0.1.12 (2025-01-20): ì´ˆê¸° ì¬í•´ ë³µêµ¬ ê°€ì´ë“œ ì‘ì„±
- SQLite/ChromaDB í†µí•© ë³µêµ¬ ì ˆì°¨ ì¶”ê°€
- ìë™ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸ ë¬¸ì„œí™”