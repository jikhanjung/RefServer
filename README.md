# RefServer v1.0.0

ğŸš€ **ê³¼í•™ ë…¼ë¬¸ PDFë¥¼ ìœ„í•œ ì™„ì „í•œ AI ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸**

RefServerëŠ” í•™ìˆ  ë…¼ë¬¸ PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ OCR, í’ˆì§ˆ í‰ê°€, ì„ë² ë”© ìƒì„±, ë ˆì´ì•„ì›ƒ ë¶„ì„, ë©”íƒ€ë°ì´í„° ì¶”ì¶œì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” í†µí•© ì§€ëŠ¥í˜• ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸ‰ **êµ¬í˜„ ì™„ë£Œ ìƒíƒœ**
- âœ… **9ê°œ í•µì‹¬ ëª¨ë“ˆ** ì™„ì „ êµ¬í˜„
- âœ… **12ê°œ API ì—”ë“œí¬ì¸íŠ¸** ì œê³µ
- âœ… **Docker ë°°í¬** ì¤€ë¹„ ì™„ë£Œ
- âœ… **ì¢…í•© í…ŒìŠ¤íŠ¸** ì‹œìŠ¤í…œ í¬í•¨
- âœ… **í”„ë¡œë•ì…˜ ì‚¬ìš©** ê°€ëŠ¥

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

- **ğŸ” ìŠ¤ë§ˆíŠ¸ OCR**: ocrmypdf + 10ê°œ ì–¸ì–´ ìë™ ê°ì§€ + í•„ìš”ì‹œì—ë§Œ ìˆ˜í–‰
- **ğŸ¯ í’ˆì§ˆ í‰ê°€**: LLaVA ê¸°ë°˜ OCR í’ˆì§ˆ ì ìˆ˜ ë° ê°œì„  ì œì•ˆ
- **ğŸ§  ì„ë² ë”© ìƒì„±**: BGE-M3 ëª¨ë¸ë¡œ 1024ì°¨ì› ë²¡í„° ìƒì„± + ì¤‘ë³µ ê°ì§€
- **ğŸ“ ë ˆì´ì•„ì›ƒ ë¶„ì„**: Huridocs APIë¡œ í…ìŠ¤íŠ¸/ë„í‘œ/ê·¸ë¦¼ ìš”ì†Œ êµ¬ì¡° ë¶„ì„
- **ğŸ“š ë©”íƒ€ë°ì´í„° ì¶”ì¶œ**: LLM ê¸°ë°˜ ì œëª©/ì €ì/ì €ë„/DOI/ì´ˆë¡ ì¶”ì¶œ
- **ğŸ’¾ í†µí•© ì €ì¥**: SQLite + Peewee ORM + ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜

## ğŸ¯ API ì—”ë“œí¬ì¸íŠ¸

### í•µì‹¬ ê¸°ëŠ¥
- **`POST /process`** - PDF ì—…ë¡œë“œ ë° ì „ì²´ íŒŒì´í”„ë¼ì¸ ìë™ ì²˜ë¦¬
- **`GET /status`** - ëª¨ë“  ì„œë¹„ìŠ¤ ìƒíƒœ ì‹¤ì‹œê°„ í™•ì¸

### ë°ì´í„° ì¡°íšŒ
- **`GET /paper/{doc_id}`** - ë…¼ë¬¸ ê¸°ë³¸ ì •ë³´ (íŒŒì¼ëª…, OCR í’ˆì§ˆ ë“±)
- **`GET /metadata/{doc_id}`** - ì„œì§€ì •ë³´ (ì œëª©, ì €ì, ì €ë„, ì—°ë„ ë“±)
- **`GET /embedding/{doc_id}`** - 1024ì°¨ì› ë²¡í„° ì„ë² ë”©
- **`GET /layout/{doc_id}`** - í˜ì´ì§€ë³„ ë ˆì´ì•„ì›ƒ êµ¬ì¡° ë¶„ì„
- **`GET /text/{doc_id}`** - ì¶”ì¶œëœ ì „ì²´ í…ìŠ¤íŠ¸

### íŒŒì¼ ë‹¤ìš´ë¡œë“œ
- **`GET /preview/{doc_id}`** - ì²« í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ (PNG)
- **`GET /download/{doc_id}`** - ì²˜ë¦¬ëœ PDF íŒŒì¼

### ê²€ìƒ‰ ë° í†µê³„
- **`GET /search`** - ë…¼ë¬¸ ê²€ìƒ‰ (ì œëª©, ì €ì, ì—°ë„)
- **`GET /stats`** - ì‹œìŠ¤í…œ í†µê³„ ë° ì²˜ë¦¬ ì„±ê³µë¥ 

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ì „ì œ ì¡°ê±´
```bash
# Docker ë° Docker Compose ì„¤ì¹˜ í™•ì¸
docker --version
docker-compose --version

# Ollama ì„¤ì¹˜ ë° ëª¨ë¸ ì¤€ë¹„
ollama run llava        # OCR í’ˆì§ˆ í‰ê°€ìš©
ollama run llama3.2     # ë©”íƒ€ë°ì´í„° ì¶”ì¶œìš©
```

### 2. ì„¤ì¹˜ ë° ì‹¤í–‰

#### ì˜µì…˜ A: Docker Hubì—ì„œ ë°”ë¡œ ì‹¤í–‰ (ê¶Œì¥)
```bash
# ì‚¬ì „ ë¹Œë“œëœ ì´ë¯¸ì§€ ì‚¬ìš©
docker pull honestjung/refserver:latest
docker run -p 8000:8000 -v refserver_data:/data honestjung/refserver:latest
```

#### ì˜µì…˜ B: ì†ŒìŠ¤ì½”ë“œì—ì„œ ë¹Œë“œ
```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/jikhanjung/RefServer
cd RefServer

# ì„œë¹„ìŠ¤ ì‹¤í–‰ (BGE-M3 ëª¨ë¸ ìë™ ë‹¤ìš´ë¡œë“œ í¬í•¨)
docker-compose up --build
```

### 3. API í…ŒìŠ¤íŠ¸
```bash
# í…ŒìŠ¤íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements-test.txt

# ì „ì²´ API ìë™ í…ŒìŠ¤íŠ¸
python test_api.py

# íŠ¹ì • PDF íŒŒì¼ë¡œ í…ŒìŠ¤íŠ¸
python test_api.py --pdf /path/to/paper.pdf

# API ë¬¸ì„œ í™•ì¸
open http://localhost:8000/docs
```

### 4. í…ŒìŠ¤íŠ¸ ê²°ê³¼ (v1.0.0)
```
ğŸ“Š Test Summary
   Total tests: 14
   Passed: 14 âœ…
   Failed: 0 âŒ
   Success rate: 100.0%
   Total time: ~3-4ë¶„ (CPU í™˜ê²½)
```

**ê²€ì¦ ì™„ë£Œëœ ê¸°ëŠ¥:**
- âœ… PDF ì—…ë¡œë“œ ë° ì „ì²´ íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬
- âœ… OCR + 10ê°œ ì–¸ì–´ ìë™ ê°ì§€
- âœ… BGE-M3 ì„ë² ë”© ìƒì„± (1024ì°¨ì›)
- âœ… LLM ê¸°ë°˜ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
- âœ… ì¤‘ë³µ ì»¨í…ì¸  ê°ì§€ ì‹œìŠ¤í…œ
- âœ… ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
RefServer/ (v1.0.0 ì™„ì „ êµ¬í˜„)
â”œâ”€â”€ ğŸ³ docker-compose.yml        # ì„œë¹„ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”œâ”€â”€ ğŸ“¦ Dockerfile               # ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì •ì˜
â”œâ”€â”€ ğŸ“‹ requirements.txt         # Python ì˜ì¡´ì„±
â”œâ”€â”€ ğŸ“‹ requirements-test.txt    # í…ŒìŠ¤íŠ¸ ì˜ì¡´ì„±
â”œâ”€â”€ ğŸ§ª test_api.py             # ì¢…í•© API í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ âœ…
â”œâ”€â”€ ğŸ“¥ download_model.py        # BGE-M3 ëª¨ë¸ ë‹¤ìš´ë¡œë“œ âœ…
â”œâ”€â”€ ğŸ”„ migrate.py              # ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ âœ…
â”œâ”€â”€ ğŸ“ app/                    # í•µì‹¬ ì• í”Œë¦¬ì¼€ì´ì…˜ (9ê°œ ëª¨ë“ˆ)
â”‚   â”œâ”€â”€ ğŸŒ main.py             # FastAPI ì„œë²„ (12ê°œ ì—”ë“œí¬ì¸íŠ¸) âœ…
â”‚   â”œâ”€â”€ ğŸ”— pipeline.py         # 7ë‹¨ê³„ í†µí•© ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ âœ…
â”‚   â”œâ”€â”€ ğŸ—„ï¸ models.py           # Peewee ORM ëª¨ë¸ (4ê°œ í…Œì´ë¸”) âœ…
â”‚   â”œâ”€â”€ ğŸ’¾ db.py               # ì™„ì „í•œ CRUD ì¸í„°í˜ì´ìŠ¤ âœ…
â”‚   â”œâ”€â”€ ğŸ” ocr.py              # OCR + 10ê°œ ì–¸ì–´ ìë™ ê°ì§€ âœ…
â”‚   â”œâ”€â”€ ğŸ¯ ocr_quality.py      # LLaVA í’ˆì§ˆ í‰ê°€ (via Ollama) âœ…
â”‚   â”œâ”€â”€ ğŸ§  embedding.py        # BGE-M3 ì„ë² ë”© + ë¡œì»¬ ëª¨ë¸ âœ…
â”‚   â”œâ”€â”€ ğŸ“ layout.py           # Huridocs ë ˆì´ì•„ì›ƒ ë¶„ì„ âœ…
â”‚   â””â”€â”€ ğŸ“š metadata.py         # 3ë‹¨ê³„ LLM ë©”íƒ€ë°ì´í„° ì¶”ì¶œ âœ…
â”œâ”€â”€ ğŸ“ data/                   # ë°ì´í„° ì €ì¥ì†Œ (ë³¼ë¥¨ ë§ˆìš´íŠ¸)
â”‚   â”œâ”€â”€ pdfs/                  # ì²˜ë¦¬ëœ PDF íŒŒì¼
â”‚   â”œâ”€â”€ images/                # ì²« í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸°
â”‚   â”œâ”€â”€ temp/                  # ì„ì‹œ íŒŒì¼ (ìë™ ì •ë¦¬)
â”‚   â””â”€â”€ refserver.db           # SQLite ë°ì´í„°ë² ì´ìŠ¤
â”œâ”€â”€ ğŸ“ models/                 # BGE-M3 ë¡œì»¬ ëª¨ë¸ (ì„ íƒì‚¬í•­)
â”‚   â””â”€â”€ bge-m3-local/
â””â”€â”€ ğŸ“„ API_TESTING_GUIDE.md    # ì™„ì „í•œ API í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ âœ…
```

## ğŸ”§ ì•„í‚¤í…ì²˜ ë° ì²˜ë¦¬ íë¦„

### 7ë‹¨ê³„ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
```mermaid
graph TD
    A[PDF ì—…ë¡œë“œ] --> B[1. íŒŒì¼ ì €ì¥ & DB ê¸°ë¡]
    B --> C[2. OCR ì²˜ë¦¬ & ì–¸ì–´ ê°ì§€]
    C --> D[3. LLaVA í’ˆì§ˆ í‰ê°€]
    D --> E[4. BGE-M3 ì„ë² ë”© ìƒì„±]
    E --> F[5. Huridocs ë ˆì´ì•„ì›ƒ ë¶„ì„]
    F --> G[6. LLM ë©”íƒ€ë°ì´í„° ì¶”ì¶œ]
    G --> H[7. ì •ë¦¬ & ê²°ê³¼ ë°˜í™˜]
```

### ê¸°ìˆ  ìŠ¤íƒ
- **ğŸ Backend**: FastAPI + Pydantic + Uvicorn
- **ğŸ—„ï¸ Database**: SQLite + Peewee ORM + peewee-migrate
- **ğŸ” OCR**: ocrmypdf + Tesseract (10ê°œ ì–¸ì–´)
- **ğŸ¤– AI Models**: 
  - BGE-M3 (ì„ë² ë”©) - ë¡œì»¬ ëª¨ë¸ (Docker ì´ë¯¸ì§€ í¬í•¨)
  - LLaVA (í’ˆì§ˆ í‰ê°€) - via Ollama
  - Llama 3.2 (ë©”íƒ€ë°ì´í„°) - via Ollama
- **ğŸ“ Layout**: Huridocs PDF Document Layout Analysis
- **ğŸ³ Deployment**: Docker + Docker Compose

### Docker ì´ë¯¸ì§€ ì •ë³´
- **ì´ë¯¸ì§€**: `honestjung/refserver:latest`
- **í¬ê¸°**: 21GB (BGE-M3 ëª¨ë¸ í¬í•¨)
- **ì•„í‚¤í…ì²˜**: x86_64 (Intel/AMD)
- **ë² ì´ìŠ¤**: Python 3.11-slim
- **í¬í•¨ ëª¨ë¸**: BGE-M3 (BAAI/bge-m3)

## ğŸ›ï¸ ì„¤ì • ë° í™˜ê²½ë³€ìˆ˜

```bash
# Docker Compose í™˜ê²½ë³€ìˆ˜
OLLAMA_HOST=host.docker.internal:11434    # Ollama ì„œë²„ ì£¼ì†Œ
HURIDOCS_LAYOUT_URL=http://huridocs-layout:5000  # Huridocs ì„œë¹„ìŠ¤

# ë°ì´í„° ë³¼ë¥¨
./data:/data    # í˜¸ìŠ¤íŠ¸ data ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸
```

## ğŸ“Š ì„±ëŠ¥ íŠ¹ì„±

- **ì²˜ë¦¬ ì‹œê°„**: 1-3ë¶„ (PDF í¬ê¸°ì— ë”°ë¼)
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: 2-4GB (BGE-M3 ëª¨ë¸ í¬í•¨)
- **ë™ì‹œ ì²˜ë¦¬**: FastAPI ë¹„ë™ê¸° ì§€ì›
- **í™•ì¥ì„±**: ê° ì²˜ë¦¬ ë‹¨ê³„ ë…ë¦½ì  ì‹¤í–‰ ê°€ëŠ¥
- **ë‚´ê²°í•¨ì„±**: ì¼ë¶€ ì„œë¹„ìŠ¤ ì¥ì•  ì‹œì—ë„ ê¸°ë³¸ ì²˜ë¦¬ ì§€ì†

## ğŸ§ª API í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ

### ìë™í™”ëœ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
```bash
# ì „ì²´ API ìë™ í…ŒìŠ¤íŠ¸ (12ê°œ ì—”ë“œí¬ì¸íŠ¸)
python test_api.py

# íŠ¹ì • PDF íŒŒì¼ë¡œ í…ŒìŠ¤íŠ¸
python test_api.py --pdf /path/to/paper.pdf

# ì›ê²© ì„œë²„ í…ŒìŠ¤íŠ¸
python test_api.py --url http://server:8000
```

### í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì˜ˆì‹œ

```bash
[17:44:54] INFO: ğŸš€ Starting RefServer API Tests
[17:44:54] PASS: âœ… Health Check - PASSED (200)
[17:44:54] PASS: âœ… Service Status - PASSED (200) 
[17:48:06] PASS: âœ… PDF Processing - PASSED (200)
[17:48:06] INFO:    Document ID: 6bf75b69-036d-43e2-afd8-3f90891f11f0
[17:48:06] INFO:    Processing time: 191.84s
[17:48:06] INFO:    Steps completed: 5, Steps failed: 1
[17:48:06] INFO:    Warnings: Similar content detected, Layout analysis unavailable
[17:48:06] INFO: ğŸ“Š Test Summary
[17:48:06] INFO:    Total tests: 14
[17:48:06] INFO:    Passed: 14 âœ…  Failed: 0 âŒ
[17:48:06] INFO:    Success rate: 100.0%
```

## ğŸ› ï¸ ê°œë°œ ë° ê¸°ì—¬

### ë¡œì»¬ ê°œë°œ í™˜ê²½
```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
pip install -r requirements-test.txt

# BGE-M3 ëª¨ë¸ ë‹¤ìš´ë¡œë“œ (ì„ íƒì‚¬í•­)
python download_model.py

# ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
python migrate.py

# ê°œë°œ ì„œë²„ ì‹¤í–‰
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### ì¢…í•© í…ŒìŠ¤íŠ¸
```bash
# ì „ì²´ API í…ŒìŠ¤íŠ¸
python test_api.py --url http://localhost:8000

# ìƒì„¸í•œ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
# API_TESTING_GUIDE.md ì°¸ì¡°
```

### ì£¼ìš” íŠ¹ì§•
- **ë‚´ê²°í•¨ì„±**: ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¥ì•  ì‹œì—ë„ ê¸°ë³¸ ê¸°ëŠ¥ ìœ ì§€
- **í™•ì¥ì„±**: ê° ì²˜ë¦¬ ë‹¨ê³„ ë…ë¦½ì  ì‹¤í–‰ ê°€ëŠ¥
- **ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ (`/status`)
- **ì¤‘ë³µ ê°ì§€**: ë‚´ìš© ê¸°ë°˜ ê³ ìœ  IDë¡œ ì¤‘ë³µ ë…¼ë¬¸ ìë™ ê°ì§€

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” MIT ë¼ì´ì„ ìŠ¤ í•˜ì— ì œê³µë©ë‹ˆë‹¤.

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

 RefServerëŠ” ì™„ì „íˆ êµ¬í˜„ëœ í”„ë¡œë•ì…˜ ì¤€ë¹„ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ê¸°ì—¬ë¥¼ ì›í•˜ì‹œëŠ” ê²½ìš°:

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/AmazingFeature`)
3. Run tests (`python test_api.py`)
4. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
5. Push to the branch (`git push origin feature/AmazingFeature`)
6. Open a Pull Request

### ê°œì„  ì•„ì´ë””ì–´
- PostgreSQL + pgvector ì§€ì›
- ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰ ê¸°ëŠ¥ ê°•í™”
- ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”
- ì¶”ê°€ ì–¸ì–´ ì§€ì›

---

## ğŸ¯ **í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ**

RefServer v1.0.0ì€ ì™„ì „íˆ êµ¬í˜„ë˜ì–´ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

### âœ… **êµ¬í˜„ ì™„ë£Œ í˜„í™©**
- **9ê°œ í•µì‹¬ ëª¨ë“ˆ**: ëª¨ë“  ì²˜ë¦¬ ë‹¨ê³„ ì™„ì „ êµ¬í˜„
- **12ê°œ API ì—”ë“œí¬ì¸íŠ¸**: ì™„ì „í•œ REST API ì œê³µ
- **ì¢…í•© í…ŒìŠ¤íŠ¸**: ìë™í™”ëœ API í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- **Docker ë°°í¬**: ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì‰¬ìš´ ë°°í¬
- **ì™„ì „í•œ ë¬¸ì„œí™”**: ì„¤ì¹˜, ì‚¬ìš©ë²•, í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### ğŸš€ **ì„±ëŠ¥ íŠ¹ì„±**
- **ì²˜ë¦¬ ì‹œê°„**: 1-3ë¶„ (PDF í¬ê¸°ì— ë”°ë¼)
- **ì„±ê³µë¥ **: 90%+ (ëª¨ë“  ì„œë¹„ìŠ¤ ì •ìƒ ì‹œ)
- **ë‚´ê²°í•¨ì„±**: ë¶€ë¶„ ì„œë¹„ìŠ¤ ì¥ì• ì—ë„ ê¸°ë³¸ ê¸°ëŠ¥ ìœ ì§€
- **í™•ì¥ì„±**: ê°œë³„ ëª¨ë“ˆ ë…ë¦½ì  í™•ì¥ ê°€ëŠ¥

---

**RefServer v1.0.0** - ì™„ì „í•œ PDF ì§€ëŠ¥í˜• ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ğŸ‰